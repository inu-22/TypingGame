document.onkeydown = typeGame;  //ã‚­ãƒ¼æŠ¼ä¸‹æ™‚ã«é–¢æ•°typeGame()ã‚’å‘¼ã³å‡ºã™

//æ–‡å­—ã‚’æ ¼ç´ã™ã‚‹é…åˆ—
var alphabet = new Array("ï¼¡","ï¼¢","ï¼£","ï¼¤","ï¼¥","ï¼¦","ï¼§","ï¼¨","ï¼©","ï¼ª","ï¼«","ï¼¬","ï¼­","ï¼®","ï¼¯","ï¼°","ï¼±","ï¼²","ï¼³","ï¼´","ï¼µ","ï¼¶","ï¼·","ï¼¸","ï¼¹","ï¼º");

//ã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’æ ¼ç´ã™ã‚‹é…åˆ—
var kcode = new Array(65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90);
  
//0ï½25ã¾ã§ã®ä¹±æ•°ã‚’æ ¼ç´ã™ã‚‹é…åˆ—
var rnd = new Array();
// ãã‚Œãã‚Œã®æ™‚é–“ã‚’æ ¼ç´ã™ã‚‹é…åˆ—
var recTime = new Array();
  
//ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ç¾¤
var mondai = ""; /*å•é¡Œã®æ–‡å­—åˆ—ã‚’æ ¼ç´*/
var cnt_question = 0; /* ä½•å•ç›®ã‹æ ¼ç´ */
var cnt_game = 0; /* ä½•å›ç›®ã®æŒ‘æˆ¦ã‹æ ¼ç´ */
var typStart,typEnd;   /* é–‹å§‹æ™‚ã¨çµ‚äº†æ™‚ã®æ™‚åˆ»ã‚’æ ¼ç´ */
var cnt_miss = 0; /* ã‚¿ã‚¤ãƒ—ãƒŸã‚¹ã®å›æ•°ã‚’æ•°ãˆã‚‹å¤‰æ•° */

//0ï½25ã¾ã§ã®ä¹±æ•°ã‚’10å€‹ä½œæˆã—ã¦é…åˆ—rndã«æ ¼ç´ã™ã‚‹é–¢æ•°
function ransu() {
  for (var i = 0; i < 10; i++) {
    rnd[i] = Math.floor( Math.random() * 26 );
  }
}

//ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®å•é¡Œã‚’ã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°
function gameSet() {
  //å•é¡Œæ–‡ã¨ã‚«ã‚¦ãƒ³ãƒˆæ•°ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹
  mondai = "";
  cnt_question = 0;
  //ä¹±æ•°ä½œæˆé–¢æ•°ã®å‘¼ã³å‡ºã—
  ransu();
  
  //å•é¡Œæ–‡ã®ä½œæˆï¼ˆé…åˆ—alphabetã®è¦ç´ ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«10æ–‡å­—ç¹‹ã’ã‚‹ï¼‰
  //mondai= "" + alphabet[rnd[0]] + alphabet[rnd[1]] + â€¦ + alphabet[rnd[9]]ã¨ãªã‚‹
  for (var i = 0; i < 10; i++) {
    mondai =  mondai + alphabet[ rnd[i] ];
  }
  
  //å•é¡Œæ ã«è¡¨ç¤ºã™ã‚‹
  document.getElementById("mondai").innerHTML = mondai;
}

//ã‚­ãƒ¼å…¥åŠ›ã‚’å—ã‘å–ã‚‹é–¢æ•°
function typeGame(evt) {
  var kc;  //å…¥åŠ›ã•ã‚ŒãŸã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’æ ¼ç´ã™ã‚‹å¤‰æ•°
  //å…¥åŠ›ã•ã‚ŒãŸã‚­ãƒ¼ã®ã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
  if (document)ã€€{
    kc = event.keyCode;
  }ã€€elseã€€{
    kc = evt.which;
  }
  //å…¥åŠ›ã•ã‚ŒãŸã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã€å•é¡Œæ–‡ã®ã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’æ¯”è¼ƒ
  if (kc == kcode[ rnd[cnt_question] ])ã€€{
    //ä»¥ä¸‹ã€ã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ãŸæ™‚ã®å‡¦ç†    
    //æœ€åˆã®1æ–‡å­—ãŒå…¥åŠ›ã•ã‚ŒãŸæ™‚é–“ã‚’è¨˜éŒ²ã™ã‚‹
    if (cnt_question == 0)ã€€{ 
      typStart = new Date();
    }
    
    cnt_question++; //ã‚«ã‚¦ãƒ³ãƒˆæ•°ã‚’ï¼‹ï¼‘ã«ã™ã‚‹
    
    //å…¨æ–‡å­—å…¥åŠ›ã—ãŸã‹ç¢ºèª
    if (cnt_question < 10)ã€€{
      //å•é¡Œæ–‡ã®é ­ã®ä¸€æ–‡å­—ã‚’åˆ‡ã‚Šå–ã‚‹
      mondai = mondai.substring(1,mondai.Length);

      //å•é¡Œæ ã«è¡¨ç¤ºã™ã‚‹
      document.getElementById("mondai").innerHTML = mondai;
    }ã€€elseã€€{
      //å…¨æ–‡å­—å…¥åŠ›ã—ã¦ã„ãŸã‚‰ã€çµ‚äº†æ™‚é–“ã‚’è¨˜éŒ²ã™ã‚‹
      typEnd = new Date();
      //å…¨æ–‡å­—å…¥åŠ›ã—ã¦ã„ãŸã‚‰ã€ç·æŒ‘æˆ¦æ•°ã‚’è¨˜éŒ²ã™ã‚‹
      cnt_game++;
      
      //çµ‚äº†æ™‚é–“ï¼é–‹å§‹æ™‚é–“ã§æ›ã‹ã£ãŸãƒŸãƒªç§’ã‚’å–å¾—ã™ã‚‹
      var keika = typEnd - typStart;
      
      //1000ã§å‰²ã£ã¦ã€Œåˆ‡æ¨ã¦ã€ã€ç§’æ•°ã‚’å–å¾—
      var sec = Math.floor( keika/1000 );
      
      //1000ã§å‰²ã£ãŸã€Œä½™ã‚Š(%ã§å–å¾—ã§ãã‚‹ï¼‰ã€ã§ãƒŸãƒªç§’ã‚’å–å¾—
      var msec = keika % 1000;
      
      //å•é¡Œçµ‚äº†ã‚’å‘Šã’ã‚‹æ–‡å­—åˆ—ã‚’ä½œæˆ
      var time1 = "æ™‚é–“ï¼š" + sec + "ç§’" + msec;
      //å•é¡Œæ ã«ã‚²ãƒ¼ãƒ çµ‚äº†ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤º
      if (sec > 5) {
        document.getElementById("mondai").innerHTML = "é…ã„ã§ã™ã­ãˆ";	
      } else if (sec > 3) {
        document.getElementById("mondai").innerHTML = "ã¯ã‚„ã„ï¼ï¼";
      } else {
        document.getElementById("mondai").innerHTML = "ã‚ãªãŸã¯ç¥ã§ã™ğŸ‘¼";
        msec += "âœ¨";/* ç¥è¨˜éŒ²ã®æœ€å¾Œã«çµµæ–‡å­—ã¤ã‘ãŸã„ã€€*/
      }
      // æ™‚é–“ã¨ã‚¿ã‚¤ãƒ—ãƒŸã‚¹å›æ•°ã‚’è¡¨ç¤ºã™ã‚‹
      document.getElementById("result").innerHTML = "<br>\n"+ time1 + "<br>\n" + "ã‚¿ã‚¤ãƒ—ãƒŸã‚¹ï¼š"+ cnt_miss;
      // record_boxã«ã“ã‚Œã¾ã§ã®è¨˜éŒ²æ™‚é–“ã‚’è¡¨ç¤ºã™ã‚‹
      document.getElementById("element").innerHTML += "ç¬¬" + cnt_game + "å› " + sec + "ç§’" + msec +  "<br>\n";
      // ã‚¿ã‚¤ãƒ—ãƒŸã‚¹ã®å›æ•°ã‚’åˆæœŸå€¤ã«æˆ»ã™
      cnt_miss = 0;
    }
  } else {
    cnt_miss++;
  }
}